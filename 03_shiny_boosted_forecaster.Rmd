---
title: "Shiny Boosted Forecaster"
output: 
    flexdashboard::flex_dashboard:
        theme:
            bg: "#000000"
            fg: "#18bc9c"
            primary: "#2c3e50"
            base_font: !expr bslib::font_google("Oswald")
runtime: shiny
---
    
    ```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo    = FALSE,
    message = FALSE, 
    warning = FALSE
)

# IMPORTANT NOTE!!!
# INSTALL DEVELOPMENT VERSION OF RMARKDOWN AND CROSSTALK
# rmarkdown   * 2.6.6   2021-02-02 [1] Github (rstudio/rmarkdown@d8e7a15)

# Run These:
# remotes::install_github("rstudio/rmarkdown")
# remotes::install_github("rstudio/crosstalk")

library(shiny)
library(collapsibleTree)
library(tidyverse)
library(timetk)

```


```{r}
sales_sample_tbl <- read_rds("m5-forecasting-accuracy/sales_sample_tbl.rds")

hierarchy_tbl <- sales_sample_tbl %>% select(contains("id"))


full_data_tbl <- read_rds("m5-forecasting-accuracy/full_data_tbl.rds")

purchases_summarized_tbl <- full_data_tbl %>%
    select(category, identifier, value) %>%
    group_by(category, identifier) %>%
    summarise(value = sum(value, na.rm = T)) %>%
    ungroup() %>%
    filter(category == 'item_id') %>%
    pivot_wider(
        names_from  = category, 
        values_from = identifier
    )
```




# Customer Exploration

## Column {.sidebar}

#### How it works

__Customer Exploration__ is an important part of knowing:
    
- who will purchase
- what they will purchase
- and, when they will purchase

This app aggregates customer purchasing behavior into a convenient tool. Simply click on Customer Segmentation Visualization to "Drill In" to Purchasing Behavior.
<hr>
    
#### Purchase Timeline
    
```{r}

```


```{r}

```




## Column 1

### Customer Segmentation


```{r}
purchases_summarized_tbl %>%
    collapsibleTree(
        hierarchy = c("state_id", "store_id", "cat_id", "dept_id", "item_id"),
        attribute = "value",
        root      = "All Stores",
        aggFun    = sum, 
        nodeSize  = "value",
        tooltip   = TRUE, 
        fontSize  = 16
    )
```


```{r}
purchases_summarized_tbl
```





# Customer Data

## Column 1

### Customer Information

```{r}

```


## Column 2

### Invoice Information

```{r}

```


